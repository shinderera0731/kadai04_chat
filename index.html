<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./css/chat.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>
<body>
 !-- ğŸ” ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ -->
<div class="login-overlay" id="loginScreen">
    <div class="login-card glass">
        <div class="login-content">
            <h2 class="login-title">ğŸŒ¸ FlowerS</h2>
            <p class="login-subtitle">ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒãƒ£ãƒƒãƒˆä½“é¨“ã¸ã‚ˆã†ã“ã</p>

            <div id="mainLogin">
                <button class="btn btn-primary login-btn" id="googleLogin">
                    <span>ğŸ“§ Googleã§ç¶šã‘ã‚‹</span>
                </button>
                <button class="btn btn-secondary login-btn" id="showEmailForm">
                    <span>âœ‰ï¸ ãƒ¡ãƒ¼ãƒ«ã§ç¶šã‘ã‚‹</span>
                </button>
                <button class="btn btn-glass login-btn" id="guestLogin">
                    <span>ğŸ‘¤ ã‚²ã‚¹ãƒˆã§ä½“é¨“</span>
                </button>
            </div>

            <div class="login-form" id="emailForm">
                <input type="email" class="input login-input" id="email" placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹">
                <input type="password" class="input login-input" id="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆ6æ–‡å­—ä»¥ä¸Šï¼‰">
                <button class="btn btn-success login-btn" id="emailLogin">ãƒ­ã‚°ã‚¤ãƒ³</button>
                <button class="btn btn-success login-btn" id="emailSignup">æ–°è¦ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ</button>
                <button class="btn btn-glass login-btn" id="backToMain">æˆ»ã‚‹</button>
            </div>
        </div>
    </div>
</div>

<!-- ğŸ’¬ ãƒãƒ£ãƒƒãƒˆç”»é¢ -->
<div class="chat-container">
    <div class="chat-card glass">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="header">
            <div class="header-controls">
                <div class="user-badge" id="userInfo" style="display: none;">ğŸ‘¤ ã‚²ã‚¹ãƒˆ</div>
                <div class="status-indicator status-connecting" id="status">æ¥ç¶šä¸­</div>
            </div>
            <button class="logout-btn" id="logoutBtn" style="display: none;">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
            <h1>ğŸŒ¸ FlowerS</h1>
            <p>æ¬¡ä¸–ä»£ãƒãƒ£ãƒƒãƒˆä½“é¨“</p>
        </div>

        <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
        <div class="messages-container" id="messages">
            <div class="message message-system">
                <div class="message-bubble">
                    <div>FlowerS ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ã¸ã‚ˆã†ã“ãï¼ğŸŒºâœ¨</div>
                    <div class="message-time">ğŸ¤– ã‚·ã‚¹ãƒ†ãƒ </div>
                </div>
            </div>
            <div class="typing-indicator" id="typingIndicator">èª°ã‹ãŒå…¥åŠ›ä¸­... âœï¸</div>
            <div class="message-count" id="messageCount">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: 1</div>
        </div>

        <!-- å…¥åŠ›ã‚¨ãƒªã‚¢ -->
        <div class="input-container">
            <div class="input-row">
                <input type="text" class="input input-name" id="name" placeholder="ãªã¾ãˆ" value="ã‚²ã‚¹ãƒˆ">
                <input type="text" class="input input-message" id="text" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›...">
                <button class="send-button" id="send">é€ä¿¡</button>
            </div>
        </div>
    </div>
</div>

<script type="module">
    // ğŸŒ¸ FlowerS ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒãƒ£ãƒƒãƒˆ
    let allMessages = [], currentUser = null, isOnline = false, db = null, messageCount = 0;

    const firebaseConfig = {
        apiKey: "",
        authDomain: "flowers-messages.firebaseapp.com",
        projectId: "flowers-messages",
        storageBucket: "flowers-messages.firebasestorage.app",
        messagingSenderId: "654187005633",
        appId: "1:654187005633:web:99cb3e0f5f6a4a7a2c7640"
    };

    // ğŸ”” é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ 
    function showNotification(message, type = 'info') {
        const notification = $(`<div class="notification notification-${type}">${message}</div>`);
        $('body').append(notification);
        setTimeout(() => {
            notification.css('animation', 'notificationSlide 0.3s cubic-bezier(0.4, 0, 0.2, 1) reverse');
            setTimeout(() => notification.remove(), 300);
        }, 3000);
    }

    // ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼åå–å¾—
    function getUserName() {
        return currentUser ? (currentUser.displayName || currentUser.email || 'ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼') : ($("#name").val() || 'ã‚²ã‚¹ãƒˆ');
    }

    // ğŸ“Š ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
    function setStatus(type, text) {
        $("#status").removeClass().addClass(`status-indicator status-${type}`).text(text);
    }

    // ğŸ“ˆ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•°æ›´æ–°
    function updateMessageCount() {
        messageCount = allMessages.length + 1;
        $("#messageCount").text(`ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: ${messageCount}`);
    }

    // ğŸ”¥ FirebaseåˆæœŸåŒ–
    async function initializeFirebase() {
        if (!firebaseConfig.apiKey) {
            setStatus('offline', 'ã‚ªãƒ•ãƒ©ã‚¤ãƒ³');
            return false;
        }

        try {
            setStatus('connecting', 'æ¥ç¶šä¸­');
            const { initializeApp } = await import('https://www.gstatic.com/firebasejs/11.9.0/firebase-app.js');
            const { getFirestore, collection, addDoc, onSnapshot, serverTimestamp, query, orderBy } = await import('https://www.gstatic.com/firebasejs/11.9.0/firebase-firestore.js');
            const { getAuth, GoogleAuthProvider, signInWithPopup, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged } = await import('https://www.gstatic.com/firebasejs/11.9.0/firebase-auth.js');

            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            const auth = getAuth(app);

            Object.assign(window, { auth, googleProvider: new GoogleAuthProvider(), signInWithPopup, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, addDoc, collection, serverTimestamp });

            onAuthStateChanged(auth, (user) => {
                currentUser = user;
                updateUserInfo();
                user ? (showChatScreen(), showNotification(`${user.displayName || user.email}ã•ã‚“ã€ã‚ˆã†ã“ãï¼`, 'success'), setupMessageListener()) : showLoginScreen();
            });

            const setupMessageListener = () => {
                const messagesRef = collection(db, "flowers-messages");
                onSnapshot(query(messagesRef, orderBy('time', 'asc')), (snapshot) => {
                    allMessages = [];
                    snapshot.forEach((doc) => {
                        const data = doc.data();
                        allMessages.push({
                            id: doc.id,
                            name: data.name || 'ã‚²ã‚¹ãƒˆ',
                            text: data.text || '',
                            time: data.time ? data.time.toDate() : new Date(),
                            userId: data.userId || null,
                            isOnline: true
                        });
                    });
                    displayMessages();
                    updateMessageCount();
                });
                isOnline = true;
                setStatus('online', 'ã‚ªãƒ³ãƒ©ã‚¤ãƒ³');
            };

            return true;
        } catch (error) {
            setStatus('offline', 'ã‚¨ãƒ©ãƒ¼');
            return false;
        }
    }

    // ğŸ–¥ï¸ ç”»é¢åˆ‡ã‚Šæ›¿ãˆ
    function showLoginScreen() {
        $("#loginScreen").css('display', 'flex');
    }

    function showChatScreen() {
        $("#loginScreen").fadeOut(300);
    }

    // ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±æ›´æ–°
    function updateUserInfo() {
        if (currentUser) {
            const name = currentUser.displayName || currentUser.email || 'ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼';
            $("#userInfo").text(`ğŸ‘¤ ${name}`).show();
            $("#logoutBtn").show();
            $("#name").val(name).prop('disabled', true);
        } else {
            $("#userInfo").hide();
            $("#logoutBtn").hide();
            $("#name").val('ã‚²ã‚¹ãƒˆ').prop('disabled', false);
        }
    }

    // ğŸ” èªè¨¼æ©Ÿèƒ½
    async function loginWithGoogle() {
        if (!window.auth) return showNotification('Firebaseèªè¨¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
        try {
            await window.signInWithPopup(window.auth, window.googleProvider);
        } catch (error) {
            const messages = {
                'auth/popup-blocked': 'ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã¾ã™',
                'auth/popup-closed-by-user': 'ãƒ­ã‚°ã‚¤ãƒ³ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸ'
            };
            showNotification(messages[error.code] || 'Googleãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
        }
    }

    async function loginWithEmail() {
        const email = $("#email").val().trim(), password = $("#password").val();
        if (!email || !password) return showNotification('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'warning');
        if (!window.auth) return showNotification('Firebaseèªè¨¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
        try {
            await window.signInWithEmailAndPassword(window.auth, email, password);
            $("#email, #password").val('');
        } catch (error) {
            const messages = {
                'auth/user-not-found': 'ã“ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“',
                'auth/wrong-password': 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™',
                'auth/invalid-email': 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“'
            };
            showNotification(messages[error.code] || 'ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
        }
    }

    async function signupWithEmail() {
        const email = $("#email").val().trim(), password = $("#password").val();
        if (!email || !password) return showNotification('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'warning');
        if (password.length < 6) return showNotification('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯6æ–‡å­—ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„', 'warning');
        if (!window.auth) return showNotification('Firebaseèªè¨¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
        try {
            await window.createUserWithEmailAndPassword(window.auth, email, password);
            showNotification('æ–°è¦ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸï¼', 'success');
            $("#email, #password").val('');
        } catch (error) {
            const messages = {
                'auth/email-already-in-use': 'ã“ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯æ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™',
                'auth/weak-password': 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå¼±ã™ãã¾ã™',
                'auth/invalid-email': 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“'
            };
            showNotification(messages[error.code] || 'æ–°è¦ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
        }
    }

    async function logout() {
        if (!window.auth) return showNotification('Firebaseèªè¨¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
        try {
            await window.signOut(window.auth);
            allMessages = [];
            displayMessages();
            showNotification('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ', 'info');
        } catch (error) {
            showNotification('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
        }
    }

    // ğŸ’¬ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
    function displayMessages() {
        const $messages = $("#messages");
        const systemMsg = $messages.find('.message-system').first();
        const typingIndicator = $("#typingIndicator");
        const messageCountEl = $("#messageCount");

        $messages.empty();
        $messages.append(systemMsg);

        allMessages.forEach(msg => {
            const isMe = (currentUser && msg.userId === currentUser.uid) || (!currentUser && msg.name === getUserName());
            const time = msg.time.toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' });
            const messageClass = isMe ? 'message-me' : 'message-other';
            const icon = isMe ? 'ğŸ‘¤' : 'ğŸ‘»';
            const indicator = msg.isOnline ? 'ğŸŒ' : 'ğŸ“±';

            $messages.append(`
                <div class="message ${messageClass}">
                    <div class="message-bubble">
                        <div>${msg.text}</div>
                        <div class="message-time">
                            <span>${icon}</span>
                            <span>${msg.name}</span>
                            <span>â€¢</span>
                            <span>${time}</span>
                            <span>${indicator}</span>
                        </div>
                    </div>
                </div>
            `);
        });

        $messages.append(typingIndicator);
        $messages.append(messageCountEl);
        $messages.scrollTop($messages[0].scrollHeight);
    }

    // ğŸ“ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
    async function sendMessage() {
        const text = $("#text").val().trim(), name = getUserName();
        if (!text) return showNotification('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'warning');
        if (text.length > 500) return showNotification('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒé•·ã™ãã¾ã™ï¼ˆ500æ–‡å­—ä»¥å†…ï¼‰', 'error');

        const userMsg = {
            id: 'user_' + Date.now(),
            name, text,
            time: new Date(),
            userId: currentUser?.uid || null,
            isOffline: !isOnline
        };

        allMessages.push(userMsg);
        displayMessages();
        updateMessageCount();
        $("#text").val('');

        // é€ä¿¡ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
        const $sendBtn = $("#send");
        $sendBtn.css('transform', 'scale(0.95)');
        setTimeout(() => $sendBtn.css('transform', ''), 100);

        if (isOnline && window.addDoc) {
            try {
                await window.addDoc(window.collection(db, "flowers-messages"), {
                    name: userMsg.name,
                    text: userMsg.text,
                    time: window.serverTimestamp(),
                    userId: currentUser?.uid || null
                });
                showNotification('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¾ã—ãŸï¼', 'success');
            } catch (error) {
                showNotification('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        } else {
            showNotification('ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¾ã—ãŸ', 'info');
        }
    }

    // ğŸ“± ãƒ‡ãƒ¢ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    function addDemoMessages() {
        const demos = [
            { name: 'ã•ãã‚‰', text: 'ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒãƒ£ãƒƒãƒˆã™ã”ãç¶ºéº—ã§ã™ã­ï¼ğŸŒ¸', delay: 2000 },
            { name: 'ã¯ãª', text: 'ã‚°ãƒ©ã‚¹ãƒ¢ãƒ¼ãƒ•ã‚£ã‚ºãƒ ãŒã¨ã¦ã‚‚ç¾ã—ã„âœ¨', delay: 4000 },
            { name: 'ã¿ã©ã‚Š', text: 'ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚‚ã‚¹ãƒ ãƒ¼ã‚ºã§æ„Ÿå‹•ã—ã¾ã™ğŸ­', delay: 6000 }
        ];

        demos.forEach((msg, i) => {
            setTimeout(() => {
                allMessages.push({
                    id: 'demo_' + i,
                    name: msg.name,
                    text: msg.text,
                    time: new Date(),
                    userId: null,
                    isOffline: true
                });
                displayMessages();
                updateMessageCount();
            }, msg.delay);
        });
    }

    // âŒ¨ï¸ ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼
    let typingTimer;
    function handleTyping() {
        $("#typingIndicator").show();
        clearTimeout(typingTimer);
        typingTimer = setTimeout(() => $("#typingIndicator").hide(), 2000);
    }

    // ğŸ›ï¸ ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š
    function setupEvents() {
        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
        $("#send").on("click", sendMessage);
        $("#text").on("keypress", e => {
            if (e.key === 'Enter') {
                e.preventDefault();
                sendMessage();
            }
        }).on("input", handleTyping);

        // èªè¨¼
        $("#googleLogin").on("click", loginWithGoogle);
        $("#emailLogin").on("click", loginWithEmail);
        $("#emailSignup").on("click", signupWithEmail);
        $("#logoutBtn").on("click", logout);

        // ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢åˆ¶å¾¡
        $("#guestLogin").on("click", () => {
            showChatScreen();
            showNotification('ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ä½“é¨“ã¸ã‚ˆã†ã“ãï¼', 'success');
            setTimeout(() => addDemoMessages(), 1000);
        });

        $("#showEmailForm").on("click", () => {
            $("#mainLogin").fadeOut(200, () => $("#emailForm").fadeIn(200));
        });

        $("#backToMain").on("click", () => {
            $("#emailForm").fadeOut(200, () => {
                $("#mainLogin").fadeIn(200);
                $("#email, #password").val('');
            });
        });

        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
        $(document).on('keydown', e => {
            if (e.ctrlKey && e.key === 'Enter') sendMessage();
            if (e.ctrlKey && e.shiftKey && e.key === 'L' && currentUser) {
                e.preventDefault();
                logout();
            }
        });

        // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ç®¡ç†
        $("#text").focus();

        // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
        $(".input").on('focus', function () {
            $(this).parent().addClass('input-focused');
        }).on('blur', function () {
            $(this).parent().removeClass('input-focused');
        });
    }

    // ğŸŒ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç›£è¦–
    function setupNetworkMonitoring() {
        window.addEventListener('online', () => {
            showNotification('ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«å†æ¥ç¶šã—ã¾ã—ãŸ', 'success');
            if (firebaseConfig.apiKey) initializeFirebase();
        });

        window.addEventListener('offline', () => {
            isOnline = false;
            setStatus('offline', 'ã‚ªãƒ•ãƒ©ã‚¤ãƒ³');
            showNotification('ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰ã§ã™', 'warning');
        });
    }

    // ğŸ¨ å‹•çš„ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
    function setupDynamicEffects() {
        // ãƒ‘ãƒ©ãƒ©ãƒƒã‚¯ã‚¹åŠ¹æœ
        $(window).on('scroll', () => {
            const scrolled = $(window).scrollTop();
            $('.header').css('transform', `translateY(${scrolled * 0.5}px)`);
        });

        // ãƒã‚¦ã‚¹è¿½è·¡ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
        $(document).on('mousemove', (e) => {
            const x = (e.clientX / window.innerWidth) * 100;
            const y = (e.clientY / window.innerHeight) * 100;

            $('body').css('background-position', `${x}% ${y}%`);
        });

        // ã‚¯ãƒªãƒƒã‚¯ãƒªãƒƒãƒ—ãƒ«åŠ¹æœ
        $('.btn').on('click', function (e) {
            const $this = $(this);
            const offset = $this.offset();
            const x = e.pageX - offset.left;
            const y = e.pageY - offset.top;

            const $ripple = $('<span class="ripple"></span>');
            $ripple.css({
                position: 'absolute',
                left: x - 10,
                top: y - 10,
                width: 20,
                height: 20,
                background: 'rgba(255,255,255,0.6)',
                borderRadius: '50%',
                transform: 'scale(0)',
                animation: 'rippleEffect 0.6s ease-out',
                pointerEvents: 'none'
            });

            $this.append($ripple);
            setTimeout(() => $ripple.remove(), 600);
        });

        // ãƒªãƒƒãƒ—ãƒ«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
        $('<style>').text(`
            @keyframes rippleEffect {
                to {
                    transform: scale(4);
                    opacity: 0;
                }
            }
        `).appendTo('head');
    }

    // ğŸš€ åˆæœŸåŒ–
    $(document).ready(async () => {
        console.log('ğŸŒ¸ FlowerS ãƒ—ãƒ¬ãƒŸã‚¢ãƒ é–‹å§‹ï¼');

        setupEvents();
        setupNetworkMonitoring();
        setupDynamicEffects();

        // ã‚¹ãƒ—ãƒ©ãƒƒã‚·ãƒ¥åŠ¹æœ
        $('body').css('opacity', '0').animate({ opacity: 1 }, 800);

        const initialized = await initializeFirebase();
        if (!initialized) {
            showLoginScreen();
            setTimeout(() => {
                showNotification('Firebaseè¨­å®šã‚’è¿½åŠ ã™ã‚‹ã¨å…¨æ©Ÿèƒ½ãŒä½¿ãˆã¾ã™', 'info');
            }, 2000);
        }

        // ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        setTimeout(() => {
            showNotification('FlowerS ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ã¸ã‚ˆã†ã“ãï¼ğŸŒ¸âœ¨', 'success');
        }, 1000);
    });
        //ã‚ˆãã‚ã‚‹é–“é•ã„

          //  apiKeyãŒé–“é•ã£ã¦ã„ã‚‹
            //projectIdãŒé–“é•ã£ã¦ã„ã‚‹
            //Firestoreã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³åãŒé•ã†
            //Firebase SDKã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå¤ã„ / æ–°ã—ã„
    </script>
    
</body>
</html>